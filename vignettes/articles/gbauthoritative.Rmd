---
title: "gbAuthoritative coverage and metadata"
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  warning = FALSE,
  message = FALSE,
  tidy = "styler",
  dev = "ragg_png",
  dpi = 300,
  out.width = "100%"
)

src <- "gbAuthoritative"
```

## `r src` coverage

```{r gautho-coverage, echo=FALSE,  fig.alt="World coverage"}
library(rgeoboundaries)
library(ggplot2)
library(dplyr)

world <- gb_get_world()
max_lvl <- gb_get_max_adm_lvl(release_type = src)

unq <- max_lvl$maxBoundaryType %>%
  sort() %>%
  unique()
p <- world |>
  mutate(boundaryISO = shapeGroup) |>
  left_join(max_lvl) |>
  mutate(max_lvl = factor(maxBoundaryType,
    levels = 0:5
  ))

pal <- c("#0e221b", "#0f4a38", "#0b6e4f", "#719384", "#b9975a", "#936e28")

pal_end <- pal
names(pal_end) <- levels(p$max_lvl)
ggplot(p) +
  geom_sf(fill = "#e5e5e5", color = "#e5e5e5") +
  geom_sf(aes(fill = max_lvl), color = "transparent", show.legend = TRUE) +
  scale_fill_manual(values = pal_end, na.translate = FALSE, drop = FALSE) +
  guides(fill = guide_legend(direction = "horizontal", nrow = 1)) +
  coord_sf(expand = TRUE, crs = "+proj=robin") +
  theme_void() +
  theme(
    plot.background = element_rect(fill = "white", color = NA),
    text = element_text(family = "sans", face = "bold"),
    legend.position = "bottom",
    legend.title.position = "top",
    legend.title = element_text(size = rel(0.75), face = "plain"),
    legend.text = element_text(size = rel(1)),
    legend.text.position = "right",
    legend.key.height = unit(1, "line"),
    legend.key.width = unit(1, "line")
  ) +
  labs(fill = "Administrative Divisions (ADMs)")
```

## `r src` metadata

```{r metadata, echo=FALSE}
meta <- gb_get_metadata(release_type = src)
meta$staticDownloadLink <- paste0(
  '<a href="', meta$staticDownloadLink,
  '" class="external-link"><i class="fa-solid fa-download"></i></a>'
)

meta$gjDownloadURL <- paste0(
  '<a href="', meta$gjDownloadURL,
  '" class="external-link"><i class="fa-solid fa-download"></i></a>'
)

meta$tjDownloadURL <- paste0(
  '<a href="', meta$tjDownloadURL,
  '" class="external-link"><i class="fa-solid fa-download"></i></a>'
)

meta$simplifiedGeometryGeoJSON <- paste0(
  '<a href="', meta$simplifiedGeometryGeoJSON,
  '" class="external-link"><i class="fa-solid fa-download"></i></a>'
)

meta$imagePreview <- paste0(
  '<img src="', meta$imagePreview,
  '" alt="Map preview" class="img-thumbnail mx-auto d-block">'
)


library(reactable)
reactable::reactable(meta,
  filterable = TRUE,
  defaultColDef = colDef(minWidth = 200),
  columns = list(
    staticDownloadLink = colDef(html = TRUE, align = "center"),
    gjDownloadURL = colDef(html = TRUE, align = "center"),
    tjDownloadURL = colDef(html = TRUE, align = "center"),
    simplifiedGeometryGeoJSON = colDef(html = TRUE, align = "center"),
    imagePreview = colDef(html = TRUE, align = "center")
  ),
  searchable = TRUE,
  showPageSizeOptions = TRUE,
  paginationType = "jump",
  defaultPageSize = 5,
  pageSizeOptions = c(5, 10, 25, 50, 100),
  elementId = src
)
```
